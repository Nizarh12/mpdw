---
title: "MPDW Praktikum Pertemuan 1"
author: "Nizar Hermawan (G1401231054)"
date: "2025-08-30"
output: html_document
editor_options: 
  markdown: 
    wrap: sentence
---

# Import Data

```{r}
library("forecast")
library("ggplot2")
library("graphics")
library("TTR")
library("TSA")
#baca data "C:\Users\Nizar\Downloads\Documents\Data Cuaca Kelompok 2 MPDW.csv"
datacuaca <- read.csv("C:/Users/Nizar/Downloads/Documents/Data Cuaca Kelompok 2 MPDW.csv")
datacuaca
```

## ambil data date dan VPdef dan data ke 2678 - 3570

```{r}
datacuaca2 <- datacuaca[301:400, c("date", "VPdef")]
datacuaca2
```

## ubah data VPdef menjadi time series

```{r}
data.ts <- ts(datacuaca2$VPdef)
```

# Ekspolrasi data

## Ringkasan data

```{r}
summary(data.ts)
```

## Plot data time series

```{r}
ts.plot(data.ts, xlab="Time Period ", ylab="VPdef", 
        main = "Time Series Plot VPdef")
points(data.ts)
```

# sma

```{r}
# Hitung jumlah baris data
n <- nrow(datacuaca2)

# Tentukan batas 80% untuk training
n_train <- floor(0.8 * n)

# Bagi data menjadi training dan testing
training_ma <- datacuaca2[1:n_train, ]
testing_ma  <- datacuaca2[(n_train+1):n, ]

# Ubah ke time series
train_ma.ts<- ts(training_ma$VPdef)
test_ma.ts <- ts(testing_ma$VPdef)
```

```{r}
#eksplorasi kesuluraan data
plot(data.ts, col="blue",main="Plot semua data")
points(data.ts)

#eksplorasi data latih
plot(train_ma.ts, col="red",main="Plot data latih")
points(train_ma.ts)

#eksplorasi data uji
plot(test_ma.ts, col="green",main="Plot data uji")
points(test_ma.ts)
```

```{r}
data.sma<-SMA(train_ma.ts, n=4)
data.sma
```

Data pemulusan pada periode ke-t selanjutnya digunakan sebagai nilai peramalan pada periode ke t+1 sehingga hasil peramalan 1 periode kedepan adalah sebagai berikut.

```{r}
data.ramal<-c(NA,data.sma)
data.ramal #forecast 1 periode ke depan
```

```{r}
data.gab<-cbind(
  aktual=c(data.ts),
  pemulusan=c(data.sma,rep(NA,24)),
  ramalan=c(data.ramal,rep(data.ramal[length(data.ramal)],23)))

data.gab #forecast 24 periode ke depan
```

```{r}
ts.plot(data.ts, xlab="Date", ylab="Total Sales", main= "SMA N=4 Data Sales")
points(data.ts)
lines(data.gab[,2],col="green",lwd=2)
lines(data.gab[,3],col="red",lwd=2)
legend("topleft",c("data aktual","data pemulusan","data peramalan"), lty=8, col=c("black","green","red"), cex=0.5)
```

```{r}
#Menghitung nilai keakuratan data latih
error_train.sma = train_ma.ts-data.ramal[1:length(train_ma.ts)]

SSE_train.sma = sum(error_train.sma[5:length(train_ma.ts)]^2)
MSE_train.sma = mean(error_train.sma[5:length(train_ma.ts)]^2)
MAPE_train.sma = mean(abs((error_train.sma[5:length(train_ma.ts)]/train_ma.ts[5:length(train_ma.ts)])*100))

akurasi_train.sma <- matrix(c(SSE_train.sma, MSE_train.sma, MAPE_train.sma))
row.names(akurasi_train.sma)<- c("SSE", "MSE", "MAPE")
colnames(akurasi_train.sma) <- c("Akurasi m = 4")
akurasi_train.sma
```

```{r}
# Ambil data aktual (baris 81-104, kolom 1)
actual_test <- data.gab[81:104, 1]

# Ambil data ramalan (baris 81-104, kolom 3)
forecast_test <- data.gab[81:104, 3]

# Hitung error
error_test.sma <- actual_test - forecast_test

# Hitung metrik
SSE_test.sma <- sum(error_test.sma^2)
MSE_test.sma <- mean(error_test.sma^2)
MAPE_test.sma <- mean(abs(error_test.sma / actual_test * 100))

# Simpan dalam matrix
akurasi_test.sma <- matrix(c(SSE_test.sma, MSE_test.sma, MAPE_test.sma))
row.names(akurasi_test.sma) <- c("SSE", "MSE", "MAPE")
colnames(akurasi_test.sma) <- c("Akurasi m = 4")

akurasi_test.sma
```

## interpretasi sma

Training: MAPE 6.98% → cukup bagus Testing: MAPE melonjak jadi 30.93% → prediksi buruk, model kurang adaptif terhadap tren dan fluktuasi.
Kesimpulan: Kurang cocok untuk data 10-menitan yang fluktuatif/trending.

# dma

```{r}
dma <- SMA(data.sma, n = 4)
At <- 2*data.sma - dma
Bt <- 2/(4-1)*(data.sma - dma)
data.dma<- At+Bt
data.ramal<- c(NA, data.dma)

t = 1:24
f = c()

for (i in t) {
  f[i] = At[length(At)] + Bt[length(Bt)]*(i)
}

data.gab2 <- cbind(aktual = c(data.ts), 
                   pemulusan1 = c(data.sma,rep(NA,24)),
                   pemulusan2 = c(dma, rep(NA,24)),
                   At = c(At, rep(NA,24)), 
                   Bt = c(Bt,rep(NA,24)),
                   ramalan = c(data.ramal, f[-1]))
data.gab2
```

```{r}
ts.plot(data.ts, xlab="Time Period ", ylab="Sales", main= "DMA N=4 Data Sales")
points(data.ts)
lines(data.gab2[,3],col="green",lwd=2)
lines(data.gab2[,6],col="red",lwd=2)
legend("topleft",c("data aktual","data pemulusan","data peramalan"), lty=8, col=c("black","green","red"), cex=0.8)

```

```{r}
#Menghitung nilai keakuratan data latih
error_train.dma = train_ma.ts-data.ramal[1:length(train_ma.ts)]

SSE_train.dma = sum(error_train.dma[8:length(train_ma.ts)]^2)
MSE_train.dma = mean(error_train.dma[8:length(train_ma.ts)]^2)
MAPE_train.dma = mean(abs((error_train.dma[8:length(train_ma.ts)]/train_ma.ts[8:length(train_ma.ts)])*100))

akurasi_train.dma <- matrix(c(SSE_train.dma, MSE_train.dma, MAPE_train.dma))
row.names(akurasi_train.dma)<- c("SSE", "MSE", "MAPE")
colnames(akurasi_train.dma) <- c("Akurasi m = 4")
akurasi_train.dma
```

```{r}
n_test <- length(test_ma.ts)        # misal 24
error_test.dma <- test_ma.ts - data.gab2[(nrow(data.gab2)-n_test+1):nrow(data.gab2), 6]

SSE_test.dma <- sum(error_test.dma^2)
MSE_test.dma <- mean(error_test.dma^2)
MAPE_test.dma <- mean(abs(error_test.dma / test_ma.ts * 100))

akurasi_test.dma <- matrix(c(SSE_test.dma, MSE_test.dma, MAPE_test.dma))
row.names(akurasi_test.dma) <- c("SSE", "MSE", "MAPE")
colnames(akurasi_test.dma) <- c("Akurasi m = 4")
akurasi_test.dma

```

## interpretasi dma

Training: MAPE 6.25%, SSE lebih rendah dari SMA.
Testing: MAPE 9.78% → masih lebih baik dari SMA, tapi belum optimal, karena mendekati 10% Kesimpulan: Lebih responsif dari SMA, tapi belum cukup untuk data dengan tren/jumlah fluktuasi tinggi.

# ses

```{r}
# Ubah ke time series
train_ma.ts <- ts(training_ma$VPdef)
test_ma.ts  <- ts(testing_ma$VPdef)

#Cara 1 (fungsi ses)
ses.1 <- ses(train_ma.ts, h = 10, alpha = 0.2)
plot(ses.1)
ses.1
```

```{r}
ses.2<- ses(train_ma.ts, h = 10, alpha = 0.7)
plot(ses.2)
ses.2
```

```{r}
autoplot(ses.1) +
  autolayer(fitted(ses.1), series="Fitted") +
  ylab("VFdef") + xlab("Periode")
```

```{r}
#Cara 2 (fungsi Holtwinter)
ses1<- HoltWinters(train_ma.ts, gamma = FALSE, beta = FALSE, alpha = 0.2)
plot(ses1)

#ramalan
ramalan1<- forecast(ses1, h=10)
ramalan1

ses2<- HoltWinters(train_ma.ts, gamma = FALSE, beta = FALSE, alpha = 0.7)
plot(ses2)

#ramalan
ramalan2<- forecast(ses2, h=10)
ramalan2
```

```{r}
#SES
ses.opt <- ses(train_ma.ts, h = 10, alpha = NULL)
plot(ses.opt)
ses.opt

#Lamda Optimum Holt Winter
HWopt<- HoltWinters(train_ma.ts, gamma = FALSE, beta = FALSE,alpha = NULL)
HWopt
plot(HWopt)

#ramalan
ramalanopt<- forecast(HWopt, h=10)
ramalanopt
```

```{r}
#Keakuratan Metode
#Pada data training

# SES dengan alpha = 0.2
SSE1<-ses1$SSE
MSE1<-ses1$SSE/length(train_ma.ts)
RMSE1<-sqrt(MSE1)

akurasi1 <- matrix(c(SSE1,MSE1,RMSE1))
row.names(akurasi1)<- c("SSE", "MSE", "RMSE")
colnames(akurasi1) <- c("Akurasi lamda=0.2")
akurasi1

# SES dengan alpha = 0.7
SSE2<-ses2$SSE
MSE2<-ses2$SSE/length(train_ma.ts)
RMSE2<-sqrt(MSE2)

akurasi2 <- matrix(c(SSE2,MSE2,RMSE2))
row.names(akurasi2)<- c("SSE", "MSE", "RMSE")
colnames(akurasi2) <- c("Akurasi lamda=0.7")
akurasi2
```

```{r}
# Error masing-masing ramalan
e1   <- as.numeric(ramalan1$mean) - as.numeric(testing_ma$VPdef)
e2   <- as.numeric(ramalan2$mean) - as.numeric(testing_ma$VPdef)
eopt <- as.numeric(ramalanopt$mean) - as.numeric(testing_ma$VPdef)

# SSE / MSE / RMSE
SSEtesting1  <- sum(e1^2)
MSEtesting1  <- mean(e1^2)
RMSEtesting1 <- sqrt(MSEtesting1)

SSEtesting2  <- sum(e2^2)
MSEtesting2  <- mean(e2^2)
RMSEtesting2 <- sqrt(MSEtesting2)

SSEtestingopt  <- sum(eopt^2)
MSEtestingopt  <- mean(eopt^2)
RMSEtestingopt <- sqrt(MSEtestingopt)

# Gabung hasil
hasil_test <- data.frame(
  Model = c("SES α=0.2","SES α=0.7","SES Optimal"),
  SSE = c(SSEtesting1, SSEtesting2, SSEtestingopt),
  MSE = c(MSEtesting1, MSEtesting2, MSEtestingopt),
  RMSE = c(RMSEtesting1, RMSEtesting2, RMSEtestingopt)
)

hasil_test

```

## interpretasi ses

Training SES λ=0.2 → SSE = 3.35, RMSE = 0.205 → error relatif besar, model lambat mengikuti perubahan.
SES λ=0.7 → SSE = 0.826, RMSE = 0.102 → jauh lebih baik, model lebih responsif.
Kesimpulan: Pada data latih, λ besar lebih unggul → model cepat menyesuaikan diri terhadap pola data.

Testing SES α=0.2 → RMSE = 0.266 → performa turun (over-smooth).
SES α=0.7 → RMSE = 0.229 → masih lebih baik, konsisten dari training.
SES Optimal → RMSE = 0.235 → mirip dengan α=0.7, membuktikan data cocok dengan smoothing yang responsif.
Kesimpulan: Pada data uji, α besar (0.7) tetap memberikan hasil terbaik, walau error sedikit lebih tinggi dibanding data training → artinya model cukup stabil

Overall SES dengan α kecil kurang cocok untuk data 10-menitan yang fluktuatif.
SES dengan α tinggi (0.7) atau optimal lebih sesuai, karena lebih mampu menangkap pola jangka pendek.

# des

```{r}
#Lamda=0.2 dan gamma=0.2
des.1<- HoltWinters(train_ma.ts, gamma = FALSE, beta = 0.2, alpha = 0.2)
plot(des.1)

#ramalan
ramalandes1<- forecast(des.1, h=10)
ramalandes1

#Lamda=0.6 dan gamma=0.3
des.2<- HoltWinters(train_ma.ts, gamma = FALSE, beta = 0.3, alpha = 0.6)
plot(des.2)

#ramalan
ramalandes2<- forecast(des.2, h=10)
ramalandes2
```

```{r}
plot(data.ts)
lines(des.1$fitted[,1], lty=2, col="blue")
lines(ramalandes1$mean, col="red")
```

```{r}
#Lamda dan gamma optimum
des.opt<- HoltWinters(train_ma.ts, gamma = FALSE)
des.opt
plot(des.opt)

#ramalan
ramalandesopt<- forecast(des.opt, h=10)
ramalandesopt
```

```{r}
#Akurasi Data Training
ssedes.train1<-des.1$SSE
msedes.train1<-ssedes.train1/length(train_ma.ts)
sisaandes1<-ramalandes1$residuals
head(sisaandes1)

mapedes.train1 <- sum(abs(sisaandes1[3:length(train_ma.ts)]/train_ma.ts[3:length(train_ma.ts)])
                      *100)/length(train_ma.ts)

akurasides.1 <- matrix(c(ssedes.train1,msedes.train1,mapedes.train1))
row.names(akurasides.1)<- c("SSE", "MSE", "MAPE")
colnames(akurasides.1) <- c("Akurasi lamda=0.2 dan gamma=0.2")
akurasides.1

ssedes.train2<-des.2$SSE
msedes.train2<-ssedes.train2/length(train_ma.ts)
sisaandes2<-ramalandes2$residuals
head(sisaandes2)

mapedes.train2 <- sum(abs(sisaandes2[3:length(train_ma.ts)]/train_ma.ts[3:length(train_ma.ts)])
                      *100)/length(train_ma.ts)

akurasides.2 <- matrix(c(ssedes.train2,msedes.train2,mapedes.train2))
row.names(akurasides.2)<- c("SSE", "MSE", "MAPE")
colnames(akurasides.2) <- c("Akurasi lamda=0.6 dan gamma=0.3")
akurasides.2
```

```{r}
train_ma.ts <- ts(train_ma.ts, frequency = 6)
test_ma.ts  <- ts(test_ma.ts, frequency = 6, start = end(train_ma.ts) + c(0,1))  

# =========================
# DES Model 1
# =========================
# Pastikan des.1 sudah fit sebelumnya, misal:
# des.1 <- HoltWinters(train_ma.ts, alpha=0.2, beta=0.2, gamma=FALSE)

# Forecast test
pred_des1 <- forecast(des.1, h=length(test_ma.ts))$mean

# Residual test
resid_des1 <- as.numeric(test_ma.ts) - as.numeric(pred_des1)

# Akurasi
sse_des1_test <- sum(resid_des1^2)
mse_des1_test <- mean(resid_des1^2)
mape_des1_test <- mean(abs(resid_des1 / as.numeric(test_ma.ts))) * 100

# Buat matrix akurasi
akurasi_des1_test <- matrix(c(sse_des1_test, mse_des1_test, mape_des1_test),
                            nrow=3, ncol=1)
row.names(akurasi_des1_test) <- c("SSE", "MSE", "MAPE")
colnames(akurasi_des1_test) <- c("Akurasi DES1 (lamda=0.2, gamma=0.2)")
akurasi_des1_test

# =========================
# DES Model 2
# =========================
# Pastikan des.2 sudah fit sebelumnya, misal:
# des.2 <- HoltWinters(train_ma.ts, alpha=0.6, beta=0.3, gamma=FALSE)

pred_des2 <- forecast(des.2, h=length(test_ma.ts))$mean
resid_des2 <- as.numeric(test_ma.ts) - as.numeric(pred_des2)

sse_des2_test <- sum(resid_des2^2)
mse_des2_test <- mean(resid_des2^2)
mape_des2_test <- mean(abs(resid_des2 / as.numeric(test_ma.ts))) * 100

akurasi_des2_test <- matrix(c(sse_des2_test, mse_des2_test, mape_des2_test),
                            nrow=3, ncol=1)
row.names(akurasi_des2_test) <- c("SSE", "MSE", "MAPE")
colnames(akurasi_des2_test) <- c("Akurasi DES2 (lamda=0.6, gamma=0.3)")
akurasi_des2_test
```

### interpretasi des

Training: DES1 (λ=0.2, γ=0.2) → SSE = 4.17, MSE = 0.052, MAPE = 11.27% → error masih cukup tinggi, model terlalu lambat mengikuti tren.
DES2 (λ=0.6, γ=0.3) → SSE = 0.94, MSE = 0.0117, MAPE = 4.91% → jauh lebih baik, error rendah, model lebih adaptif.
esimpulan: Pada data latih, kombinasi λ besar + γ sedang (DES2) jauh lebih akurat dibanding DES1.

Testing: DES1 → SSE = 0.189, MSE = 0.00946, MAPE = 4.36% → performa cukup baik.
DES2 → SSE = 0.203, MSE = 0.0101, MAPE = 4.15% → sedikit lebih baik dari DES1 (MAPE lebih rendah).
esimpulan: Pada data uji, DES2 tetap unggul, meskipun selisih dengan DES1 tipis.

# Kesimpulan

DES2 (λ=0.6, γ=0.3) memberikan performa terbaik secara konsisten baik di training maupun testing.
Model ini paling mampu menangani level + tren pada data 10-menitan.
Perbedaan tipis di data uji menunjukkan model stabil dan generalisasi baik, bukan hanya cocok di data latih.
